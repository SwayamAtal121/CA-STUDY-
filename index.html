<!DOCTYPE html>

<html>
<head>
<title>CA Study Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;}

body{
font-family:'Inter',sans-serif;
margin:0;
background:linear-gradient(135deg,#020617,#0f172a);
color:white;
}

.app{
max-width:1350px;
margin:auto;
padding:30px 18px;
}

h1{text-align:center;margin-bottom:18px;}

.userSwitch{
display:flex;
justify-content:center;
gap:14px;
margin-bottom:24px;
}

.userBtn{
padding:10px 26px;
border-radius:999px;
cursor:pointer;
background:rgba(255,255,255,0.06);
}

.userBtn.active{
background:#22c55e;
box-shadow:0 0 16px rgba(34,197,94,.6);
}

.tabs{
display:flex;
justify-content:center;
gap:12px;
margin-bottom:26px;
flex-wrap:wrap;
}

.tab{
padding:10px 22px;
border-radius:999px;
cursor:pointer;
background:rgba(255,255,255,0.06);
}

.tab.active{
background:#6366f1;
box-shadow:0 0 18px rgba(99,102,241,.6);
}

.container{
display:grid;
grid-template-columns:1fr 1fr;
gap:24px;
}

.card{
background:rgba(255,255,255,0.05);
padding:24px;
border-radius:20px;
backdrop-filter:blur(14px);
}

.row{
display:flex;
justify-content:space-between;
align-items:center;
padding:12px;
border-radius:12px;
margin-bottom:10px;
background:rgba(255,255,255,0.04);
}

.inputGroup{display:flex;gap:8px;}

input,select{
padding:8px;
border-radius:10px;
border:none;
background:rgba(255,255,255,0.12);
color:white;
}

button{
border:none;
padding:9px 16px;
border-radius:10px;
background:#6366f1;
color:white;
cursor:pointer;
}

.subjectCard{
margin-top:24px;
padding:18px;
border-radius:18px;
background:rgba(255,255,255,0.04);
overflow-x:auto;
}

.subjectTitle{
font-weight:600;
margin-bottom:12px;
font-size:18px;
color:#a5b4fc;
}

table{
width:100%;
min-width:650px;
border-collapse:separate;
border-spacing:0 8px;
}

tr{background:rgba(255,255,255,0.05);}

th,td{
padding:12px;
text-align:center;
}

td:first-child{text-align:left;font-weight:500;}
th{color:#c7d2fe;}

input[type="checkbox"]{
width:18px;
height:18px;
accent-color:#6366f1;
cursor:pointer;
}

.hidden{display:none;}

@media(max-width:900px){
.container{grid-template-columns:1fr;}
}
</style>

</head>

<body>

<div class="app">

<h1>ðŸ“˜ CA Study Tracker</h1>

<div class="userSwitch">
<div class="userBtn active" onclick="switchUser(event,'Swayam')">Swayam</div>
<div class="userBtn" onclick="switchUser(event,'Nishika')">Nishika</div>
</div>

<div class="tabs">
<div class="tab active" onclick="switchTab('hours')">Study Hours</div>
<div class="tab" onclick="switchTab('completion')">Completion</div>
<div class="tab" onclick="switchTab('revision')">Revision</div>
</div>

<div id="hoursTab">
<div class="container">
<div class="card">
<h3>Enter Study Hours</h3>
<div id="inputs"></div>
</div>

<div class="card">
<h3>Study Distribution</h3>
<canvas id="pieChart"></canvas>
</div>
</div>
</div>

<div id="completionTab" class="hidden">
<div class="card">
<div style="display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap;">
<select id="completionSubject">
<option>AFM</option><option>FR</option><option>DT</option>
<option>IDT</option><option>Audit</option>
</select>
<input id="completionChapter" placeholder="Chapter name">
<button onclick="addCompletion()">Add</button>
</div>
<div id="completionTables"></div>
</div>
</div>

<div id="revisionTab" class="hidden">
<div class="card">
<div style="display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap;">
<select id="revisionSubject">
<option>AFM</option><option>FR</option><option>DT</option>
<option>IDT</option><option>Audit</option>
</select>
<input id="revisionChapter" placeholder="Chapter name">
<button onclick="addRevision()">Add</button>
</div>
<div id="revisionTables"></div>
</div>
</div>

</div>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import { getDatabase, ref, set, onValue, get }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD-K-dXLSlLUqj_qir5PMtrxblzcq_PqY4",
  authDomain: "study-8c93f.firebaseapp.com",
  databaseURL: "https://study-8c93f-default-rtdb.firebaseio.com",
  projectId: "study-8c93f",
  storageBucket: "study-8c93f.firebasestorage.app",
  messagingSenderId: "467115751481",
  appId: "1:467115751481:web:54f32f6d2fb036378bf5e8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/******** DATA ********/

let appData = {};
let currentUser="Swayam";
let isSyncing = true; // â­ prevents overwrite

function createEmpty(){
return {
hours:{},
completion:{AFM:[],FR:[],DT:[],IDT:[],Audit:[]},
revision:{AFM:[],FR:[],DT:[],IDT:[],Audit:[]}
};
}

function save(){

// ðŸš¨ never write while Firebase is syncing
if(isSyncing) return;

set(ref(db, "caStudyTracker"), appData);
}

/******** USER SWITCH ********/

function switchUser(e, user){

currentUser=user;

document.querySelectorAll(".userBtn")
.forEach(b=>b.classList.remove("active"));

e.target.classList.add("active");

loadUser();
}

/******** TABS ********/

function switchTab(tab){

document.querySelectorAll('.tab')
.forEach(t=>t.classList.remove('active'));

document.getElementById('hoursTab').classList.add('hidden');
document.getElementById('completionTab').classList.add('hidden');
document.getElementById('revisionTab').classList.add('hidden');

if(tab==='hours'){
document.getElementById('hoursTab').classList.remove('hidden');
document.querySelectorAll('.tab')[0].classList.add('active');
}
else if(tab==='completion'){
document.getElementById('completionTab').classList.remove('hidden');
document.querySelectorAll('.tab')[1].classList.add('active');
}
else{
document.getElementById('revisionTab').classList.remove('hidden');
document.querySelectorAll('.tab')[2].classList.add('active');
}
}

/******** PIE ********/

const subjects=["AFM","FR","DT","IDT","Audit"];
const baseColors=["99,102,241","34,197,94","245,158,11","239,68,68","6,182,212"];

const inputsDiv=document.getElementById("inputs");

subjects.forEach(subject=>{
const row=document.createElement("div");
row.className="row";

row.innerHTML=`
<span>${subject}</span>
<div class="inputGroup">
<input type="number" placeholder="Total" id="${subject}-total">
<input type="number" placeholder="Done" id="${subject}-completed">
</div>`;

inputsDiv.appendChild(row);
});

const chart=new Chart(document.getElementById('pieChart'),{
type:'doughnut',
data:{labels:[],datasets:[{data:[],backgroundColor:[],borderWidth:0}]},
options:{plugins:{legend:{labels:{color:"white"}}},cutout:"65%"}
});

function loadUser(){

const data = appData[currentUser] || createEmpty();

subjects.forEach(subject=>{
document.getElementById(`${subject}-total`).value=data.hours[subject]?.total||"";
document.getElementById(`${subject}-completed`).value=data.hours[subject]?.completed||"";
});

renderCompletion();
renderRevision();

// unlock AFTER inputs fill
setTimeout(()=>{
isSyncing = false;
},400);

updateChart();
}

document.querySelectorAll("input")
.forEach(i=>i.addEventListener("input",updateChart));

function updateChart(){

if(!appData[currentUser]){
appData[currentUser]=createEmpty();
}

const labels=[];
const data=[];
const colors=[];

subjects.forEach((subject,i)=>{

const total=parseFloat(document.getElementById(`${subject}-total`).value)||0;
const completed=Math.min(parseFloat(document.getElementById(`${subject}-completed`).value)||0,total);

appData[currentUser].hours[subject]={total,completed};

if(total>0){

const remaining=total-completed;

if(completed>0){
labels.push(subject+" âœ”");
data.push(completed);
colors.push(`rgba(${baseColors[i]},1)`);
}

if(remaining>0){
labels.push(subject);
data.push(remaining);
colors.push(`rgba(${baseColors[i]},.2)`);
}
}
});

save();

chart.data.labels=labels;
chart.data.datasets[0].data=data;
chart.data.datasets[0].backgroundColor=colors;
chart.update();
}

/******** INIT ********/

async function initializeIfFirstTime(){

const snapshot = await get(ref(db,"caStudyTracker"));

if(!snapshot.exists()){

appData = {
Swayam:createEmpty(),
Nishika:createEmpty()
};

isSyncing = false;
save();
}
}

initializeIfFirstTime();

onValue(ref(db, "caStudyTracker"), (snapshot)=>{

const data = snapshot.val();

if(data){

isSyncing = true; // lock writes

appData = data;
loadUser();

}

});

</script>

</body>
</html>
